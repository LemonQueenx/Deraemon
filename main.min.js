var AssetAdapter=function(){function e(){}var t=(__define,e),n=t.prototype;return n.getAsset=function(e,t,n){function i(i){t.call(n,i,e)}if(RES.hasRes(e)){var a=RES.getRes(e);a?i(a):RES.getResAsync(e,i,this)}else RES.getResByUrl(e,i,this,RES.ResourceItem.TYPE_IMAGE)},e}();egret.registerClass(AssetAdapter,"AssetAdapter",["eui.IAssetAdapter"]);var CfgFileMgr=function(){function e(){}var t=(__define,e);t.prototype;return e.getLvCfgDatayId=function(e){var t=Util.formatString(["%04s",e]),n=RES.getRes("lvcfg_json");for(var i in n){var a=n[i],r=a.id;if(r==t.toString())return a}return null},e}();egret.registerClass(CfgFileMgr,"CfgFileMgr");var PlayerData=function(){function e(){}var t=(__define,e);t.prototype;return e.saveLv=function(e){e>=this.data.fightLv&&(this.data.fightLv=e),this.save()},e.initData=function(){var e=egret.localStorage.getItem("gameLocalData");e&&(this.data=JSON.parse(e))},e.save=function(){var e=JSON.stringify(this.data);egret.localStorage.setItem("gameLocalData",e)},e.data={fightLv:"1"},e}();egret.registerClass(PlayerData,"PlayerData");var SceneMgr=function(){function e(){}var t=(__define,e);t.prototype;return e.gotoLogoin=function(){var t=new ResLoading;Director.getInstance().pushScene(t);var n=(new CallBackFunc).handler(e.onLogo,this,[]);t.load(["com","logoin","mp3"],n)},e.onLogo=function(){var e=new Logoin;Director.getInstance().repleaceScene(e)},e.gotoIndex=function(){var t=new ResLoading;Director.getInstance().pushScene(t);var n=(new CallBackFunc).handler(e.onIndex,this,[]);t.load(["map","index","json"],n)},e.onIndex=function(){var e=new IndexScene;Director.getInstance().repleaceScene(e)},e.gotoGame=function(){var t=new ResLoading;Director.getInstance().pushScene(t);var n=(new CallBackFunc).handler(e.onGame,this,[]);t.load(["fruit","json"],n)},e.onGame=function(){var e=new GameScene;Director.getInstance().repleaceScene(e)},e.rePlayLv=function(){GameData.curScore=0,GameData.curStep=GameData.targetStep,GameData.isOver=!1,GameData.isWin=!1,Director.getInstance().repleaceScene(new GameScene)},e}();egret.registerClass(SceneMgr,"SceneMgr");var SoundsMgr=function(){function e(){}var t=(__define,e);t.prototype;return e.playBtn=function(){this.playMusic("button_mp3")},e.playBgm=function(){this.playMusic1("button1_mp3")},e.clickCell=function(){this.playMusic("dianji_mp3")},e.removeCell=function(e){var t=["efx_combine_1_mp3","efx_combine_2_mp3","efx_combine_3_mp3","efx_combine_4_mp3","efx_combine_5_mp3","efx_combine_6_mp3","efx_combine_7_mp3"];e>=6&&(e=6),this.playMusic(t[e])},e.win=function(){this.playMusic("win_mp3")},e.lose=function(){this.playMusic("lose_mp3")},e.playMusic=function(e){var t=RES.getRes(e.toString());t&&(this.bgSoundChannel=t.play(0,1))},e.playMusic1=function(e){var t=RES.getRes(e.toString());t&&(this.bgSoundChannel=t.play(0,1))},e.playStop=function(){var e=this.bgSoundChannel;return e?(console.log(e),e.stop(),void(this.bgSoundChannel=null)):void 0},e.bgSoundChannel=null,e}();egret.registerClass(SoundsMgr,"SoundsMgr");var LoadingUI=function(e){function t(){e.call(this),this.createView()}__extends(t,e);var n=(__define,t),i=n.prototype;return i.createView=function(){this.textField=new egret.TextField,this.addChild(this.textField),this.textField.y=300,this.textField.width=480,this.textField.height=100,this.textField.textAlign="center"},i.setProgress=function(e,t){this.textField.text="Loading..."+e+"/"+t},t}(egret.Sprite);egret.registerClass(LoadingUI,"LoadingUI");var Main=function(e){function t(){e.apply(this,arguments),this.isThemeLoadEnd=!1,this.isResourceLoadEnd=!1}__extends(t,e);var n=(__define,t),i=n.prototype;return i.createChildren=function(){e.prototype.createChildren.call(this);var t=new AssetAdapter;this.stage.registerImplementation("eui.IAssetAdapter",t),this.stage.registerImplementation("eui.IThemeAdapter",new ThemeAdapter),this.loadingView=new LoadingUI,this.stage.addChild(this.loadingView),RES.addEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this),RES.loadConfig("resource/default.res.json","resource/")},i.onConfigComplete=function(e){RES.removeEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this);var t=new eui.Theme("resource/default.thm.json",this.stage);t.addEventListener(eui.UIEvent.COMPLETE,this.onThemeLoadComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.addEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,this.onItemLoadError,this),RES.loadGroup("preload")},i.onThemeLoadComplete=function(){this.isThemeLoadEnd=!0,this.createScene()},i.onResourceLoadComplete=function(e){"preload"==e.groupName&&(this.stage.removeChild(this.loadingView),RES.removeEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.removeEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.removeEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,this.onItemLoadError,this),this.isResourceLoadEnd=!0,this.createScene())},i.createScene=function(){this.isThemeLoadEnd&&this.isResourceLoadEnd&&this.startCreateScene()},i.onItemLoadError=function(e){console.warn("Url:"+e.resItem.url+" has failed to load")},i.onResourceLoadError=function(e){console.warn("Group:"+e.groupName+" has failed to load"),this.onResourceLoadComplete(e)},i.onResourceProgress=function(e){"preload"==e.groupName&&this.loadingView.setProgress(e.itemsLoaded,e.itemsTotal)},i.startCreateScene=function(){Director.getInstance().initWithMain(this),PlayerData.initData(),SceneMgr.gotoLogoin()},t}(eui.UILayer);egret.registerClass(Main,"Main");var Cell=function(e){function t(t){e.call(this),this.id=0,this.row=0,this.column=0,this.moveFlag=!1,this.checkFlag=!1,this.sprite=null,this.isAction=!1,this.isSelected=!1,this.moveSpeed=400,this.id=t,this.sprite=new eui.Image,this.addChild(this.sprite),this.addEventListener(egret.Event.ADDED_TO_STAGE,this.addStage,this)}__extends(t,e);var n=(__define,t),i=n.prototype;return i.addStage=function(){this.init()},i.init=function(){var e=["game_Apple_png","game_Blueberry_png","game_Grape_png","game_Lemon_png","game_Watermelon_png"],n=e[this.id-1],i=RES.getRes(n);i&&(this.width=t.CellWidth,this.height=t.CellHeight,this.anchorOffsetX=this.width/2,this.anchorOffsetY=this.height/2,this.sprite.source=i,this.sprite.width=t.CellWidth,this.sprite.height=t.CellHeight,this.sprite.anchorOffsetX=this.sprite.width/2,this.sprite.anchorOffsetY=this.sprite.height/2,this.sprite.x=this.width/2,this.sprite.y=this.height/2)},i.setSelect=function(e){this.isSelected!=e&&(this.isSelected=e,e&&this.runSelectedAni())},i.runSelectedAni=function(){if(0==this.isAction){this.isAction=!0,SoundsMgr.clickCell(),egret.Tween.removeTweens(this);var e=egret.Tween.get(this);e.to({scaleX:.8,scaleY:1.3},100,egret.Ease.bounceIn).to({scaleX:1.1,scaleY:1},100,egret.Ease.bounceOut).to({scaleX:1,scaleY:1},100,egret.Ease.backIn).call(function(){this.isAction=!1},this)}},i.clean=function(){Util.removeByElements(CellMgr.cleanList,this),CellMgr.cleanCell(this);var e=egret.Tween.get(this);e.to({scaleX:.4,scaleY:.4},200).call(function(){this.sendCleanOverEvent()},this).wait(50).call(function(e){this.parent?this.parent.removeChild(this):egret.log("no parent")},this,[this])},i.drop=function(e,t){var n=CellMgr.getCellPosX(t),i=CellMgr.getCellPosY(e),a=this.getDistance({x:this.x,y:this.y},{x:n,y:i}),r=a/this.moveSpeed*1e3;this.moveFlag=!0,CellMgr.setCell(this,e,t);var s=egret.Tween.get(this);s.to({x:n,y:i},r,egret.Ease.bounceOut).call(function(){this.moveFlag=!1,this.sendDropOverEvent()},this)},i.sendDropOverEvent=function(){var e=new GameEvent(GameEvent.DropOver);this.dispatchEvent(e)},i.initTouch=function(){this.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onBegan,this),this.addEventListener(egret.TouchEvent.TOUCH_MOVE,this.onMove,this),this.addEventListener(egret.TouchEvent.TOUCH_END,this.onEnd,this)},i.onBegan=function(){egret.log("Cell Touch Began")},i.noticeAction=function(){egret.Tween.removeTweens(this);var e=egret.Tween.get(this,{loop:!0});e.to({scaleX:.8,scaleY:.8},300).to({scaleX:1,scaleY:1},300)},i.onMove=function(){},i.onEnd=function(){},i.sendCleanOverEvent=function(){var e=new GameEvent(GameEvent.CleanOver);this.dispatchEvent(e)},i.getDistance=function(e,t){var n=Math.pow(t.x-e.x,2),i=Math.pow(t.y-e.y,2),a=Math.sqrt(n+i);return a},t.CellWidth=60,t.CellHeight=60,t}(egret.Sprite);egret.registerClass(Cell,"Cell");var CellMgr=function(){function e(){}var t=(__define,e);t.prototype;return e.getTouchCell=function(e,t){for(var n in this.cellArray){var i=this.cellArray[n];for(var a in i){var r=i[a];if(r){var s=r.hitTestPoint(e,t);if(s)return r}}}return null},e.getIsLastTwoInCleanList=function(e){var t=this.cleanList.length;if(t>=2){var n=t-2,i=this.cleanList[n];if(i==e)return!0}return!1},e.removeTopLine=function(){var e=this.lineArray.length;if(e>0){var t=this.lineArray[e-1];Util.removeByElements(this.lineArray,t),t.parent&&t.parent.removeChild(t)}},e.removeTopItemInCleanList=function(){var e=this.cleanList.length;if(e>0){var t=this.cleanList[e-1];return Util.removeByElements(this.cleanList,t),t}},e.getCleanListID=function(){if(this.cleanList.length>0){var e=this.cleanList[0];return e.id}return 0},e.isInArround=function(e){var t=e.row,n=e.column,i=this.cleanList.length;if(i>0){var a=this.cleanList[i-1],r=a.row,s=a.column;if(!(r!=t+1&&r!=t-1&&r!=t||s!=n+1&&s!=n-1&&s!=n))return!0}return!1},e.getDropRowAndColumn=function(e){var t=e.row,n=e.column,i={row:t,column:n};for(t++;t<GameCfg.row;){var a=this.cellArray[t][n];if(null!=a)break;i.row++,t++}return i},e.getCellPosX=function(e){var t=Cell.CellWidth/2,n=e*(Cell.CellWidth+GameCfg.columnSpace)+t;return n},e.getCellPosY=function(e){var t=Cell.CellHeight/2,n=e*(Cell.CellHeight+GameCfg.rowSpace)+t;return n},e.setCell=function(e,t,n){var i=e.row,a=e.column;this.cellArray[i][a]=null,e.row=t,e.column=n,this.cellArray[t][n]=e},e.getEmptyCell=function(){for(var t=[],n=GameCfg.row-1;n>=0;n--)for(var i=0;i<GameCfg.column;i++){var a=e.cellArray[n][i];if(null==a){var r={row:n,column:i};t.push(r)}}return t},e.genDropCellId=function(e,t){var n=[1,2,3,4,5],i=Math.random()*n.length,a=Math.floor(i);return n[a]},e.cleanCellArray=function(){this.cellArray=[];for(var e=0;e<GameCfg.row;e++){this.cellArray.push([]);for(var t=0;t<GameCfg.column;t++)this.cellArray[e].push(null)}},e.genInitCellId=function(e,t){var n=RES.getRes("gameCellCfg_json"),i=n[1],a=i[e][t];return a},e.removeAllCellAction=function(){for(var e in this.cellArray)for(var t in this.cellArray[e]){var n=this.cellArray[e][t];n&&(egret.Tween.removeTweens(n),n.scaleX=n.scaleY=1)}},e.setAllCellCheckFlag=function(e){for(var t in this.cellArray)for(var n in this.cellArray[t]){var i=this.cellArray[t][n];i&&(i.checkFlag=e)}},e.getNowCleanListNum=function(){var e=[];for(var t in this.cellArray)for(var n in this.cellArray[t]){var i=this.cellArray[t][n];if(i&&0==i.checkFlag){var a=[i];this.getSameArrByCell(i,a),a.length>=GameCfg.baseCleanNum&&e.push(a)}}return this.setAllCellCheckFlag(!1),e},e.getSameArrByCell=function(e,t){var n=e.row,i=e.column,a=e.id;e.checkFlag=!0;var r=n,s=i-1;if(s>=0){var o=this.cellArray[r][s];o.id==a&&0==o.checkFlag&&(o.checkFlag=!0,this.getSameArrByCell(o,t),t.push(o))}var l=n,h=i+1;if(h<GameCfg.column){var c=this.cellArray[l][h];c.id==a&&0==c.checkFlag&&(c.checkFlag=!0,this.getSameArrByCell(c,t),t.push(c))}var g=n+1,d=i;if(g<GameCfg.row){var u=this.cellArray[g][d];u.id==a&&0==u.checkFlag&&(u.checkFlag=!0,this.getSameArrByCell(u,t),t.push(u))}var v=n-1,f=i;if(v>=0){var p=this.cellArray[v][f];p.id==a&&0==p.checkFlag&&(p.checkFlag=!0,this.getSameArrByCell(p,t),t.push(p))}},e.cleanCell=function(e){var t=e.row,n=e.column;this.cellArray[t][n]=null},e.isAllMove=function(){for(var e in this.cellArray){var t=this.cellArray[e];for(var n in t){var i=t[n];if(i&&1==i.moveFlag)return!0}}return!1},e.cellArray=[],e.cleanList=[],e.lineArray=[],e}();egret.registerClass(CellMgr,"CellMgr");var GameCfg=function(){function e(){}var t=(__define,e);t.prototype;return e.row=6,e.rowSpace=20,e.column=6,e.columnSpace=20,e.baseCleanNum=3,e}();egret.registerClass(GameCfg,"GameCfg");var GameData=function(){function e(){}var t=(__define,e);t.prototype;return e.reset=function(){this.enterLv=0,this.curStep=0,this.targetStep=0,this.curScore=0,this.targetScore=0,this.isOver=!1,this.isWin=!1},e.initLvData=function(t){this.reset();var n=CfgFileMgr.getLvCfgDatayId(t);e.targetScore=parseInt(n.score),e.targetStep=parseInt(n.step),e.curStep=e.targetStep,e.enterLv=t},e.enterLv=0,e.curStep=0,e.targetStep=0,e.curScore=0,e.targetScore=0,e.isOver=!1,e.isWin=!1,e}();egret.registerClass(GameData,"GameData");var GameState;!function(e){e[e.DealLogic=0]="DealLogic",e[e.Play=1]="Play"}(GameState||(GameState={}));var GameEvent=function(e){function t(t,n,i){void 0===n&&(n=!1),void 0===i&&(i=!1),e.call(this,t,n,i)}__extends(t,e);var n=(__define,t);n.prototype;return t.CleanOver="CleanOver",t.DropOver="DropOver",t}(egret.Event);egret.registerClass(GameEvent,"GameEvent");var GameScene=function(e){function t(){e.call(this),this.state=GameState.Play,this.toBottom=250,this.map=null,this.cleanIndex=0,this.UILayer=new GameUI,this.addEventListener(egret.Event.ADDED_TO_STAGE,this.addStage,this),this.onLoadMap()}__extends(t,e);var n=(__define,t),i=n.prototype;return i.addStage=function(){this.initStage(),this.initLinePanel(),this.initCellPanel(),this.initCell(),this.addChildAt(this.UILayer,1e3)},i.initStage=function(){var e=new egret.Sprite;e.name="stageBg",e.graphics.beginFill(10066329,.8),e.graphics.drawRect(0,0,Display.winSize.width,Display.winSize.height),e.graphics.endFill(),e.visible=!1,this.addChild(e)},i.initLinePanel=function(){this.linePanel=new egret.Sprite,this.linePanel.name="linePanel",this.linePanel.width=GameCfg.column*Cell.CellWidth+(GameCfg.column-1)*GameCfg.columnSpace,this.linePanel.height=GameCfg.row*Cell.CellHeight+(GameCfg.row-1)*GameCfg.rowSpace,this.linePanel.anchorOffsetX=this.linePanel.width/2,this.linePanel.anchorOffsetY=this.linePanel.height,this.linePanel.x=Display.winSize.cx,this.linePanel.y=Display.winSize.height-this.toBottom,this.linePanel.graphics.beginFill(65280,0),this.linePanel.graphics.drawRect(0,0,this.linePanel.width,this.linePanel.height),this.linePanel.graphics.endFill(),this.addChild(this.linePanel)},i.initCellPanel=function(){this.cellPanel=new egret.Sprite,this.cellPanel.name="cellPanel",this.cellPanel.width=GameCfg.column*Cell.CellWidth+(GameCfg.column-1)*GameCfg.columnSpace,this.cellPanel.height=GameCfg.row*Cell.CellHeight+(GameCfg.row-1)*GameCfg.rowSpace,this.cellPanel.anchorOffsetX=this.cellPanel.width/2,this.cellPanel.anchorOffsetY=this.cellPanel.height,this.cellPanel.x=Display.winSize.cx,this.cellPanel.y=Display.winSize.height-this.toBottom;var e=new eui.Rect(this.cellPanel.width,this.cellPanel.height,255);e.alpha=0,this.cellPanel.addChild(e),this.cellPanel.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onBegan,this),this.cellPanel.addEventListener(egret.TouchEvent.TOUCH_MOVE,this.onMove,this),this.cellPanel.addEventListener(egret.TouchEvent.TOUCH_END,this.onEnd,this),this.cellPanel.addEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,this.outSide,this),this.addChild(this.cellPanel)},i.onBegan=function(e){if(this.state==GameState.Play){this.deleteCleanList();var t=e.stageX,n=e.stageY,i=CellMgr.getTouchCell(t,n);if(i){i.setSelect(!0),this.pushCleanCell(i);var a=new egret.Point(i.x,i.y);this.createPointLine(a),this.pointLineBeganCell=i}}},i.deleteCleanList=function(){CellMgr.cleanList=[],CellMgr.lineArray=[],this.cleanIndex=0},i.pushCleanCell=function(e){CellMgr.cleanList.push(e);var t=CellMgr.cleanList.length;if(t>1){var n=CellMgr.cleanList[t-2];this.drawLine(n,e)}},i.drawLine=function(e,t){var n=RES.getRes("line_png"),i=new eui.Image;i.texture=n,i.anchorOffsetX=0,i.anchorOffsetY=n.textureHeight/2,this.linePanel.addChild(i),CellMgr.lineArray.push(i),i.x=e.x,i.y=e.y;var a=new egret.Point(e.x,e.y),r=new egret.Point(t.x,t.y),s=egret.Point.distance(a,r);i.width=s;var o=this.getAngle(a,r);i.rotation=o},i.getRotateAngle=function(e,t){var n=0,i=e.row,a=e.column,r=t.row,s=t.column;return r>i?a==s?n=90:a==s-1?n=45:a==s+1&&(n=135):i>r?a==s?n=-90:a==s-1?n=-45:a==s+1&&(n=-135):i==r&&(a==s-1?n=0:a==s+1&&(n=180)),n},i.createPointLine=function(e){this.pointLine&&this.pointLine.parent&&this.pointLine.parent.removeChild(this.pointLine),this.pointLine=new eui.Image,this.pointLine.texture=RES.getRes("line_png"),this.pointLine.width=0,this.pointLine.anchorOffsetX=0,this.pointLine.anchorOffsetY=this.pointLine.height/2,this.pointLine.x=e.x,this.pointLine.y=e.y,this.linePanel.addChild(this.pointLine)},i.createPotLine=function(e){this.pointLine&&this.pointLine.parent&&this.pointLine.parent.removeChild(this.pointLine),this.pointLine=new eui.Image,this.pointLine.texture=RES.getRes("line_png"),this.pointLine.x=e.x,this.pointLine.y=e.y,this.linePanel.addChild(this.pointLine)},i.onMove=function(e){if(this.state==GameState.Play){var t=e.stageX,n=e.stageY;this.updatePointLineEnd(t,n);var i=CellMgr.getTouchCell(t,n);if(i)if(i.isSelected){var a=CellMgr.getIsLastTwoInCleanList(i);if(a){CellMgr.removeTopLine();var r=CellMgr.removeTopItemInCleanList();r.setSelect(!1),this.updatePointLineBegan(t,n)}}else{var s=CellMgr.getCleanListID(),o=CellMgr.isInArround(i);i.id==s&&o&&(i.setSelect(!0),this.pushCleanCell(i),this.updatePointLineBegan(t,n))}}},i.updatePointLineEnd=function(e,t){if(this.pointLine&&this.pointLineBeganCell){var n=new egret.Point(this.pointLineBeganCell.x,this.pointLineBeganCell.y),i=this.linePanel.globalToLocal(e,t),a=egret.Point.distance(n,i);this.pointLine.width=a,this.pointLine.x=n.x,this.pointLine.y=n.y,this.pointLine.anchorOffsetX=0,this.pointLine.anchorOffsetY=this.pointLine.height/2;var r=this.getAngle(n,i);this.pointLine.rotation=r}},i.getAngle=function(e,t){var n=(t.x-e.x,Math.abs(t.y-e.y)),i=egret.Point.distance(e,t),a=Math.round(Math.asin(n/i)/Math.PI*180);return e.x>t.x?e.y>t.y?a+=180:e.y<t.y?a=180-a:e.y==t.y&&(a=180):e.x<t.x?e.y>t.y?a=360-a:e.y<t.y?a=a:e.y==t.y&&(a=0):e.x==t.x&&(e.y>t.y?a=270:e.y<t.y&&(a=90)),a},i.updatePointLineBegan=function(e,t){var n=CellMgr.cleanList.length;if(n>0){var i=CellMgr.cleanList[n-1];this.pointLineBeganCell=i,this.updatePointLineEnd(e,t)}},i.onEnd=function(){var e=CellMgr.cleanList.length;egret.log("可以消除的数量为: "+e),e>=GameCfg.baseCleanNum&&this.state==GameState.Play&&(this.state=GameState.DealLogic,this.cleanOneByeOne());for(var t in CellMgr.cleanList){var n=CellMgr.cleanList[t];n.setSelect(!1)}this.cleanAllLine()},i.cleanAllLine=function(){this.linePanel.removeChildren()},i.cleanOneByeOne=function(){var e=CellMgr.cleanList.length;if(0==e)this.deleteCleanList(),this.dropAndFillCell();else{var t=CellMgr.cleanList[0];this.createDirtyAndScore(t),t.clean(),SoundsMgr.removeCell(this.cleanIndex),this.cleanIndex++}},i.createDirtyAndScore=function(e){var t=["jingxiang_png","duolaameng_png","daxiong_png","panghu_png","xiaofu_png"],n=e.id,i=new eui.Image(t[n-1]),a=RES.getRes(t[n-1]);i.anchorOffsetX=a.textureWidth/2,i.anchorOffsetY=a.textureHeight/2,i.x=e.x,i.y=e.y,i.scaleX=i.scaleY=0;var r=360*Math.random();i.rotation=r,this.cellPanel.addChild(i);var s=egret.Tween.get(i);s.to({scaleX:1.2,scaleY:1.2},400,egret.Ease.bounceOut).wait(200).to({alpha:0},100).call(function(e){e&&e.parent&&e.parent.removeChild(e)},this,[i]);var o=10;this.UILayer.addScore(o);var l=new eui.Label;l.text=o.toString(),l.anchorOffsetX=l.width/2,l.anchorOffsetY=l.height/2,l.x=e.x,l.y=e.y,this.cellPanel.addChild(l);var h=egret.Tween.get(l);h.to({y:e.y-40},400).call(function(e){e&&e.parent&&e.parent.removeChild(e)},this,[l])},i.dropAndFillCell=function(){for(var e=GameCfg.row-1;e>=0;e--)for(var t=0;t<GameCfg.column;t++){var n=CellMgr.cellArray[e][t];if(null!=n){var i=CellMgr.getDropRowAndColumn(n),a=i.row,r=i.column;(n.row!=a||n.column!=r)&&n.drop(i.row,i.column)}}var s=CellMgr.getEmptyCell();for(var o in s){var l=s[o].row,h=s[o].column,c=CellMgr.genDropCellId(l,h),g=this.createCell(l,h,c);g.x=CellMgr.getCellPosX(h),g.y=-Cell.CellHeight/2,g.drop(l,h)}},i.createCell=function(e,t,n){var i=new Cell(n);return i.row=e,i.column=t,i.addEventListener(GameEvent.CleanOver,this.cleanOneByeOne,this),i.addEventListener(GameEvent.DropOver,this.onDropOver,this),CellMgr.cellArray[e][t]=i,this.cellPanel.addChild(i),i},i.onDropOver=function(){var e=CellMgr.isAllMove();0==e&&(egret.log("Drop over"),this.onStepOver())},i.onStepOver=function(){this.state=GameState.Play,this.UILayer.reduceStep()},i.outSide=function(){this.onEnd()},i.initCell=function(){CellMgr.cleanList=[],CellMgr.cleanCellArray();for(var e=0;e<GameCfg.row;e++)for(var t=0;t<GameCfg.column;t++){var n=CellMgr.genInitCellId(e,t),i=this.createCell(e,t,n);i.x=CellMgr.getCellPosX(t),i.y=CellMgr.getCellPosY(e)}},i.onLoadMap=function(){var e="resource/cleanGame/tmx/map1.tmx",t=new egret.URLLoader;t.dataFormat=egret.URLLoaderDataFormat.TEXT,t.addEventListener(egret.Event.COMPLETE,function(t){var n=egret.XML.parse(t.target.data);this.map=new tiled.TMXTilemap(2e3,2e3,n,e),this.map.render(),this.map.addEventListener(tiled.TMXImageLoadEvent.ALL_IMAGE_COMPLETE,this.onLoaded,this),this.addChildAt(this.map,1)},this),t.load(new egret.URLRequest(e))},i.onLoaded=function(){if(this.map){this.map.visible=!0,this.map.scaleX=this.map.scaleY=8/9;var e=this.map.getLayers();for(var t in e)for(var n=e[t],i=(n._name,0);i<n._rows;i++)for(var a=0;a<n._cols;a++){var r=n.getTile(i,a),s=n.getTileId(i,a);38==s&&(r.visible=!1)}}},t}(egret.DisplayObjectContainer);egret.registerClass(GameScene,"GameScene");var GameUI=function(e){function t(){e.call(this),this.star=0,this.skinName="GameUISkin",this.addEventListener(egret.Event.ADDED_TO_STAGE,this.addStage,this)}__extends(t,e);var n=(__define,t),i=n.prototype;return i.addStage=function(){this.init(),this.pauseBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onPause,this)},i.init=function(){this.progress.value=0,this.score.text="0",this.targetScore.text=GameData.targetScore.toString(),this.lv.text=GameData.enterLv.toString(),this.stepScore.text=GameData.targetStep.toString()},i.onPause=function(){SoundsMgr.playBtn(),this.addChild(new PauseLayer)},i.addScore=function(e){GameData.curScore+=e,this.score.text=GameData.curScore.toString();var t=GameData.targetScore,n=1.5*GameData.targetScore,i=2*GameData.targetScore;GameData.curScore<t?this.showStar(0):GameData.curScore>=t&&GameData.curScore<n?this.showStar(1):GameData.curScore>=n&&GameData.curScore<i?this.showStar(2):this.showStar(3);var a=GameData.curScore/i*100;this.progress.value=a},i.showStar=function(e){this.star=e,this.star1.source="game_rate1_off_png",this.star2.source="game_rate2_off_png",this.star3.source="game_rate3_off_png",1==e?this.star1.source="game_rate1_png":2==e?this.star2.source="game_rate2_png":3==e&&(this.star3.source="game_rate3_png")},i.reduceStep=function(){GameData.curStep--,this.stepScore.text=GameData.curStep.toString(),GameData.curStep<=0?(GameData.curStep=0,GameData.curScore>=GameData.targetScore?0==GameData.isOver&&(GameData.isOver=!0,GameData.isWin=!0,this.addWinLayer()):0==GameData.isOver&&(GameData.isOver=!0,GameData.isWin=!1,this.addDefeatLayer())):GameData.curScore>=GameData.targetScore&&0==GameData.isOver&&(GameData.isOver=!0,GameData.isWin=!0,this.addWinLayer())},i.addDefeatLayer=function(){Director.getInstance().pushScene(new LoseLayer)},i.addWinLayer=function(){Director.getInstance().pushScene(new WinUI(this.star))},t}(eui.Component);egret.registerClass(GameUI,"GameUI");var GameEnterDlg=function(e){function t(t){e.call(this),this.lv=t,this.skinName="GameEnterDlgSkin",this.addEventListener(egret.Event.ADDED_TO_STAGE,this.addStage,this),this.initData()}__extends(t,e);var n=(__define,t),i=n.prototype;return i.addStage=function(){this.goImg.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onGo,this),this.closeBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClose,this)},i.onClose=function(){SoundsMgr.playBtn(),Director.getInstance().popScene()},i.initData=function(){this.lvLabel.text=this.lv.toString();var e=CfgFileMgr.getLvCfgDatayId(this.lv);if(e){var t="在"+e.step+"步之内达到"+e.score+"分";this.descLabel.text=t}},i.onGo=function(){SoundsMgr.playBtn(),GameData.initLvData(this.lv),SceneMgr.gotoGame()},t}(eui.Component);egret.registerClass(GameEnterDlg,"GameEnterDlg");var LevelState;!function(e){e[e.NONE=0]="NONE",e[e.OPEN=1]="OPEN",e[e.CLOSE=2]="CLOSE"}(LevelState||(LevelState={}));var IndexButton=function(e){function t(){e.call(this),this.state=LevelState.NONE,this.lvNumber=0,this.skinName="IndexButtonSkin",this.addEventListener(egret.Event.ADDED_TO_STAGE,this.addStage,this)}__extends(t,e);var n=__define,i=t,a=i.prototype;return n(a,"lv",function(){return this.lvNumber},function(e){this.lvNumber=e,this.lvLabel.text=this.lvNumber.toString(),this.lvNumber<parseInt(PlayerData.data.fightLv)?this.setData(LevelState.OPEN):this.lvNumber==parseInt(PlayerData.data.fightLv)?(this.setData(LevelState.OPEN),this.showIcon()):this.setData(LevelState.CLOSE)}),a.showIcon=function(){this.icon.visible=!0;var e=egret.Tween.get(this.icon,{loop:!0}),t=this.icon.y;e.to({y:t+20},1200,egret.Ease.backIn).to({y:t},500,egret.Ease.backOut)},a.setData=function(e){this.state=e,this.bg.source=this.getStateImage()},a.addStage=function(){},a.getStateImage=function(){return this.state==LevelState.CLOSE?"selet_g_lock_png":this.state==LevelState.OPEN?"selet_g_blue_png":""},t}(eui.Component);egret.registerClass(IndexButton,"IndexButton");var IndexGroup=function(e){function t(){e.call(this),this.skinName="IndexGroupSkin",this.addEventListener(egret.Event.ADDED_TO_STAGE,this.addStage,this)}__extends(t,e);var n=(__define,t),i=n.prototype;return i.addStage=function(){var e=[this.btn1,this.btn2,this.btn3,this.btn4,this.btn5,this.btn6,this.btn7,this.btn8,this.btn9,this.btn10];for(var t in e){var n=e[t];n.addEventListener(egret.TouchEvent.TOUCH_TAP,this.clickBtn,this)}},i.clickBtn=function(e){SoundsMgr.playBtn();var t=e.currentTarget,n=t.lv;n<=parseInt(PlayerData.data.fightLv)?Director.getInstance().pushScene(new GameEnterDlg(n)):(new Tips).show("不能进入")},t}(eui.Component);egret.registerClass(IndexGroup,"IndexGroup");var IndexScene=function(e){function t(){e.call(this),this.prePoint=new egret.Point,this.indexUI=new IndexUI,this.addChild(this.indexUI),this.skinName="IndexSceneSkin",this.addEventListener(egret.Event.ADDED_TO_STAGE,this.addStage,this),SoundsMgr.playBgm()}__extends(t,e);var n=(__define,t),i=n.prototype;return i.addStage=function(){this.initData(),this.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onBegan,this),this.addEventListener(egret.TouchEvent.TOUCH_END,this.onEnd,this),this.addEventListener(egret.TouchEvent.TOUCH_MOVE,this.onMove,this)},i.initData=function(){this.list.addChild(new IndexGroup);var e={1:0,2:0,3:1048,4:1024,5:2048,6:2048,7:2048,8:3072,9:3072,10:3100};this.list.scrollV=e[PlayerData.data.fightLv.toString()]},i.onBegan=function(e){this.prePoint.x=e.stageX,this.prePoint.y=e.stageY},i.onMove=function(e){var t=e.stageX,n=e.stageY;this.prePoint.x=t,this.prePoint.y=n},i.onEnd=function(e){this.prePoint.x=e.stageX,this.prePoint.y=e.stageY},t}(eui.Component);egret.registerClass(IndexScene,"IndexScene");var IndexUI=function(e){function t(){e.call(this),this.skinName="IndexUISkin",this.addEventListener(egret.Event.ADDED_TO_STAGE,this.addStage,this)}__extends(t,e);var n=(__define,t),i=n.prototype;return i.addStage=function(){this.alambwtx.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){(new Tips).show("哆啦A梦伴我同行")},this),this.alambwtx1.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){(new Tips).show("哆啦A梦的乐园")},this)},t}(eui.Component);egret.registerClass(IndexUI,"IndexUI");var ResLoading=function(e){function t(){e.call(this),this.loadGroups=[],this.skinName="ResLoadingSkin",this.addEventListener(egret.Event.ADDED_TO_STAGE,this.addStage,this)}__extends(t,e);var n=(__define,t),i=n.prototype;return i.addStage=function(){this.addEventListener(egret.Event.ENTER_FRAME,this.update,this)},i.update=function(){this.circle.rotation+=3},i.load=function(e,t){egret.log("[ResLoading] 加载组:"+e),this.index=0,this.loadGroups=e,this.callback=t,RES.addEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.addEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),RES.loadGroup(this.loadGroups[this.index])},i.isAllLoaded=function(){for(var e=!0,t=0;t<this.loadGroups.length;t++)e=e&&RES.isGroupLoaded(this.loadGroups[t]);return e},i.loadFinish=function(){RES.removeEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.removeEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.removeEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),this.parent&&this.parent.removeChild(this),this.callback&&this.callback.exec()},i.onResourceLoadComplete=function(e){var t=this.isAllLoaded();egret.log("[LoadingCircle] group "+e.groupName+" loaded"),t?this.loadFinish():(this.index++,RES.loadGroup(this.loadGroups[this.index]))},i.onResourceLoadError=function(e){console.warn("Group:"+e.groupName+" has failed to load"),this.onResourceLoadComplete(e)},i.onResourceProgress=function(e){this.setProgress(e.itemsLoaded,e.itemsTotal)},i.setProgress=function(e,t){this.textLabel.text=e+"/"+t},t}(eui.Component);egret.registerClass(ResLoading,"ResLoading");var Logoin=function(e){function t(){e.call(this),this.skinName="LogoinSkin",this.addEventListener(egret.Event.ADDED_TO_STAGE,this.addStage,this)}__extends(t,e);var n=(__define,t),i=n.prototype;return i.addStage=function(){this.initDB(),this.beganBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onBegan,this);var e=egret.Tween.get(this.beganBtn,{loop:!0});e.to({scaleX:.8,scaleY:.8},1e3).to({scaleX:1,scaleY:1},1e3)},i.initDB=function(){var e=RES.getRes("NewProject_1_ske_json"),t=RES.getRes("NewProject_1_tex_json"),n=RES.getRes("NewProject_1_tex_png"),i=new dragonBones.EgretFactory;i.addDragonBonesData(dragonBones.DataParser.parseDragonBonesData(e)),i.addTextureAtlas(new dragonBones.EgretTextureAtlas(n,t));var a=i.buildArmature("Armature");this.treeGroup.addChild(a.display),a.display.x=150,a.display.y=200,dragonBones.WorldClock.clock.add(a),a.animation.gotoAndPlay("newAnimation",-1,-1,0),egret.Ticker.getInstance().register(function(e){dragonBones.WorldClock.clock.advanceTime(.1)},this)},i.onBegan=function(){SceneMgr.gotoIndex()},t}(eui.Component);egret.registerClass(Logoin,"Logoin");var LoseLayer=function(e){function t(){e.call(this),this.skinName="LoseLayerSkin",this.addEventListener(egret.Event.ADDED_TO_STAGE,this.addStage,this),SoundsMgr.lose()}__extends(t,e);var n=(__define,t),i=n.prototype;return i.addStage=function(){this.btnAgain.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onAgain,this),this.closeBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClose,this)},i.onAgain=function(){SceneMgr.rePlayLv()},i.onClose=function(){Director.getInstance().repleaceScene(new IndexScene)},t}(eui.Component);egret.registerClass(LoseLayer,"LoseLayer");var PauseLayer=function(e){function t(){e.call(this),this.skinName="PauseLayerSkin",this.addEventListener(egret.Event.ADDED_TO_STAGE,this.addStage,this)}__extends(t,e);var n=(__define,t),i=n.prototype;return i.addStage=function(){this.btn1.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){SoundsMgr.playBtn(),this.parent&&this.parent.removeChild(this)},this),this.btn2.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){SoundsMgr.playBtn(),SceneMgr.rePlayLv()},this),this.btn3.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){SoundsMgr.playBtn(),Director.getInstance().repleaceScene(new IndexScene)},this)},t}(eui.Component);egret.registerClass(PauseLayer,"PauseLayer");
var WinUI=function(e){function t(t){e.call(this),this.star=0,this.skinName="WinUISkin",this.star=t,this.addEventListener(egret.Event.ADDED_TO_STAGE,this.addStage,this),SoundsMgr.win()}__extends(t,e);var n=(__define,t),i=n.prototype;return i.addStage=function(){this.btn1Bg.addEventListener(egret.TouchEvent.TOUCH_TAP,this.clickBtn1,this),this.btn2Bg.addEventListener(egret.TouchEvent.TOUCH_TAP,this.clickBtn2,this),this.btn3Bg.addEventListener(egret.TouchEvent.TOUCH_TAP,this.clickBtn3,this),this.init(),this.saveData(),this.initStar()},i.initStar=function(){var e=[this.star1,this.star2,this.star3];for(var t in e)e[t].visible=!1;for(var n=0;n<this.star;n++)e[n].visible=!0},i.saveData=function(){PlayerData.saveLv(GameData.enterLv+1)},i.init=function(){this.numLabel.text=GameData.curScore.toString()},i.clickBtn1=function(){SceneMgr.gotoIndex()},i.clickBtn2=function(){SceneMgr.rePlayLv()},i.clickBtn3=function(){if(GameData.enterLv+1<11)GameData.initLvData(GameData.enterLv+1),SceneMgr.gotoGame();else if(GameData.enterLv+1==11){this.zjcd.visible=!0,this.zjcd1.visible=!0,this.zjcd2.visible=!0,this.zjcd3.visible=!0;var e=egret.Tween.get(this.zjcd,{loop:!0}),t=egret.Tween.get(this.zjcd1,{loop:!0}),n=egret.Tween.get(this.zjcd2,{loop:!0}),i=egret.Tween.get(this.zjcd3,{loop:!0});e.to({scaleX:.5,scaleY:.5},1e3).to({scaleX:1,scaleY:1},1e3),t.to({scaleX:1,scaleY:1},0).wait(6e3).to({scaleX:0,scaleY:0},0).wait(12e3),n.to({scaleX:0,scaleY:0},0).wait(6e3).to({scaleX:1,scaleY:1},0).wait(6e3).to({scaleX:0,scaleY:0},0).wait(6e3),i.to({scaleX:0,scaleY:0},0).wait(12e3).to({scaleX:1,scaleY:1},0).wait(6e3)}},t}(eui.Component);egret.registerClass(WinUI,"WinUI");var ThemeAdapter=function(){function e(){}var t=(__define,e),n=t.prototype;return n.getTheme=function(e,t,n,i){function a(e){t.call(i,e)}function r(t){t.resItem.url==e&&(RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,r,null),n.call(i))}RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,r,null),RES.getResByUrl(e,a,this,RES.ResourceItem.TYPE_TEXT)},e}();egret.registerClass(ThemeAdapter,"ThemeAdapter",["eui.IThemeAdapter"]);var CallBackFunc=function(){function e(){this.callBack=null,this.thisObj=null,this.args=[]}var t=(__define,e),n=t.prototype;return n.handler=function(e,t,n){return this.callBack=e,this.thisObj=t,this.args=n,this},n.exec=function(e){return void 0===e&&(e=null),e&&(this.args=e),null!=this.callBack&&null!=this.thisObj?this.callBack.apply(this.thisObj,this.args):void 0},e}();egret.registerClass(CallBackFunc,"CallBackFunc");var Director=function(){function e(){this.stackLayer=[],this.gameLayer=null}var t=(__define,e),n=t.prototype;return e.getInstance=function(){return null==e.instance&&(e.instance=new e),e.instance},n.initWithMain=function(e){null==this.gameLayer&&(this.gameLayer=e),console.log(this.gameLayer)},n.repleaceScene=function(e){null!=this.gameLayer&&null!=e&&(this.gameLayer.removeChildren(),this.gameLayer.addChild(e))},n.pushScene=function(e){null!=this.gameLayer&&null!=e&&(this.gameLayer.addChild(e),this.stackLayer.push(e))},n.popScene=function(){if(null!=this.gameLayer){var e=this.stackLayer.length;if(e>0){var t=this.stackLayer[e-1];t.parent==this.gameLayer&&(this.gameLayer.removeChild(t),Util.removeByElements(this.stackLayer,t))}}},e.instance=null,e}();egret.registerClass(Director,"Director");var Display=function(){function e(){}var t=__define,n=e;n.prototype;return t(e,"winSize",function(){return this._winSize.width=egret.MainContext.instance.stage.stageWidth,this._winSize.height=egret.MainContext.instance.stage.stageHeight,this._winSize.cx=this._winSize.width/2,this._winSize.cy=this._winSize.height/2,this._winSize}),t(e,"stage",function(){return egret.MainContext.instance.stage}),e._winSize={width:0,height:0,cx:0,cy:0},e}();egret.registerClass(Display,"Display");var Tips=function(e){function t(){e.call(this),this.bg=new eui.Image,this.bg.source=RES.getRes("tips_png"),this.bg.scale9Grid=new egret.Rectangle(55,12,9,4),this.addChild(this.bg),this.width=121,this.height=30,this.anchorOffsetX=this.width/2,this.anchorOffsetY=this.height/2,this.label=new eui.Label,this.addChild(this.label),this.x=Display.winSize.width/2,this.y=Display.winSize.height-100,egret.MainContext.instance.stage.addChildAt(this,1e5)}__extends(t,e);var n=(__define,t),i=n.prototype;return i.show=function(e){this.label.text=e,this.label.anchorOffsetX=this.label.width/2,this.label.anchorOffsetY=this.label.height/2,this.label.x=this.width/2,this.label.y=this.height/2,this.bg.width=this.label.width+50,this.bg.height=this.label.height+20,this.bg.anchorOffsetX=this.bg.width/2,this.bg.anchorOffsetY=this.bg.height/2,this.bg.x=this.width/2,this.bg.y=this.height/2;var t=egret.Tween.get(this);t.to({x:Display.winSize.width/2,y:Display.winSize.height-200},1500,egret.Ease.backOut).call(this.callback,this)},i.callback=function(){this.parent.removeChild(this)},t}(egret.DisplayObjectContainer);egret.registerClass(Tips,"Tips");var Util=function(){function e(){}var t=(__define,e);t.prototype;return e.removeByElements=function(e,t){for(var n=-1,i=e.length,a=0;i>a;a++)if(e[a]==t){n=a;break}n>=0&&e.splice(n,1)},e.formatString=function(e){for(var t,n,i,a,r,s=0,o=e[s++],l=[],h="";o;){if(n=/^[^\x25]+/.exec(o))l.push(n[0]);else if(n=/^\x25{2}/.exec(o))l.push("%");else{if(!(n=/^\x25(?:(\d+)\$)?(\+)?(0|'[^$])?(-)?(\d+)?(?:\.(\d+))?([b-fosuxX])/.exec(o)))throw"Huh ?!";if(null==(t=e[n[1]||s++])||void 0==t)throw"Too few arguments.";if(/[^s]/.test(n[7])&&"number"!=typeof t)throw"Expecting number but found "+typeof t;switch(n[7]){case"b":t=t.toString(2);break;case"c":t=String.fromCharCode(t);break;case"d":t=parseInt(t);break;case"e":t=n[6]?t.toExponential(n[6]):t.toExponential();break;case"f":t=n[6]?parseFloat(t).toFixed(n[6]):parseFloat(t);break;case"o":t=t.toString(8);break;case"s":t=(t=String(t))&&n[6]?t.substring(0,n[6]):t;break;case"u":t=Math.abs(t);break;case"x":t=t.toString(16);break;case"X":t=t.toString(16).toUpperCase()}t=/[def]/.test(n[7])&&n[2]&&t>=0?"+"+t:t,a=n[3]?"0"==n[3]?"0":n[3].charAt(1):" ",r=n[5]-String(t).length-h.length,i=n[5]?this.str_repeat(a,r):"",l.push(h+(n[4]?t+i:i+t))}o=o.substring(n[0].length)}return l.join("")},e.str_repeat=function(e,t){return new Array(t+1).join(e)},e}();egret.registerClass(Util,"Util");